<!DOCTYPE html>
<html class="writer-html5" lang="pt-br" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>A08 - Manipulação de dependência automatizada com FetchContent &mdash; cmake-tutorial  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" type="text/css" />
      <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="_static/sphinx_lesson.css" type="text/css" />
      <link rel="stylesheet" href="_static/overrides.css" type="text/css" />
      <link rel="stylesheet" href="_static/tabs.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script src="_static/clipboard.min.js"></script>
        <script src="_static/copybutton.js"></script>
        <script src="_static/minipres.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="A09 - Misturando Python e linguagens compiladas" href="python-bindings.html" />
    <link rel="prev" title="A07 - Encontrando e usando dependências" href="dependencies.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            cmake-tutorial
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Pré-Requisitos</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Configurando seu sistema</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Atividades</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="hello-cmake.html">A01 - Dos fontes para os executáveis</a></li>
<li class="toctree-l1"><a class="reference internal" href="cmake-syntax.html">A02 - Síntaxe CMake</a></li>
<li class="toctree-l1"><a class="reference internal" href="hello-ctest.html">A03 - Criando e executando testes com o CTest</a></li>
<li class="toctree-l1"><a class="reference internal" href="environment.html">A04 - Detectando seu ambiente</a></li>
<li class="toctree-l1"><a class="reference internal" href="probing.html">A05 - Compilação, vinculação e execução</a></li>
<li class="toctree-l1"><a class="reference internal" href="targets.html">A06 -Sistemas de compilação baseados em alvos com CMake</a></li>
<li class="toctree-l1"><a class="reference internal" href="dependencies.html">A07 - Encontrando e usando dependências</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">A08 - Manipulação de dependência automatizada com <code class="docutils literal notranslate"><span class="pre">FetchContent</span></code></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#o-modulo-fetchcontent">O modulo <code class="docutils literal notranslate"><span class="pre">FetchContent</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#testes-unitarios-com-catch2">Testes unitários com Catch2</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="python-bindings.html">A09 - Misturando Python e linguagens compiladas</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Referências</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="quick-reference.html">Referência rápida</a></li>
<li class="toctree-l1"><a class="reference internal" href="zbibliography.html">Bibliografia</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">cmake-tutorial</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">A08 - Manipulação de dependência automatizada com <code class="docutils literal notranslate"><span class="pre">FetchContent</span></code></li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/fetch-content.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="a08-manipulacao-de-dependencia-automatizada-com-fetchcontent">
<span id="fetch-content"></span><h1>A08 - Manipulação de dependência automatizada com <code class="docutils literal notranslate"><span class="pre">FetchContent</span></code><a class="headerlink" href="#a08-manipulacao-de-dependencia-automatizada-com-fetchcontent" title="Permalink to this heading"></a></h1>
<div class="admonition-questao questions admonition" id="questions-0">
<p class="admonition-title">Questão</p>
<ul class="simple">
<li><p>Existe uma maneira de satisfazer automaticamente as dependências do nosso código?</p></li>
</ul>
</div>
<div class="admonition-objetivos objectives admonition" id="objectives-0">
<p class="admonition-title">Objetivos</p>
<ul class="simple">
<li><p>Aprenda como baixar suas dependências em tempo de configuração com <code class="docutils literal notranslate"><span class="pre">FetchContent</span></code>.</p></li>
<li><p>Saiba como o conteúdo buscado pode ser usado de forma nativa em
seu sistema de compilação.</p></li>
</ul>
</div>
<p>O CMake oferece <strong>dois módulos</strong> para satisfazer as dependências ausentes
em tempo real: os módulos <code class="docutils literal notranslate"><span class="pre">ExternalProject</span></code> e <code class="docutils literal notranslate"><span class="pre">FetchContent</span></code>.</p>
<dl class="simple">
<dt>Usando <code class="docutils literal notranslate"><span class="pre">ExternalProject</span></code></dt><dd><ul class="simple">
<li><p>A etapa de download acontece em <a class="reference external" href="https://cmake.org/cmake/help/latest/module/ExternalProject.html">tempo de construção do projeto</a>.</p></li>
<li><p>Você pode lidar com dependências que <strong>não</strong> usam o CMake.</p></li>
<li><p>Você precisa reescrever todo o seu sistema de compilação como um <a class="reference external" href="https://github.com/dev-cafe/cmake-cookbook/blob/master/chapter-08/README.md">superbuild</a>.</p></li>
</ul>
</dd>
<dt>Usando <code class="docutils literal notranslate"><span class="pre">FetchContent</span></code></dt><dd><ul class="simple">
<li><p>A etapa de download acontece em <a class="reference external" href="https://cmake.org/cmake/help/latest/module/FetchContent.html">tempo de configuração do projeto</a>.</p></li>
<li><p>Você só pode gerenciar dependências que usam CMake.</p></li>
<li><p>É uma alteração bem delimitada em um sistema de compilação CMake existente.</p></li>
</ul>
</dd>
</dl>
<p>Ambos são mecanismos extremamente poderosos, mas você deve usá-los com cuidado.
Muitas vezes, uma documentação abrangente será suficiente para ajudar os usuários
a configurar seu ambiente para construir seu código com sucesso! Nesta atividade,
discutiremos o módulo <code class="docutils literal notranslate"><span class="pre">FetchContent</span></code>.</p>
<section id="o-modulo-fetchcontent">
<h2>O modulo <code class="docutils literal notranslate"><span class="pre">FetchContent</span></code><a class="headerlink" href="#o-modulo-fetchcontent" title="Permalink to this heading"></a></h2>
<p>Para buscar dependências dinamicamente no momento da configuração,
você incluirá o módulo interno do CMake <code class="docutils literal notranslate"><span class="pre">FetchContent</span></code>. Este módulo
faz parte do CMake desde sua versão 3.11 e vem sendo aprimorado constantemente
desde então.</p>
<p>Há duas etapas em um fluxo de trabalho baseado em <code class="docutils literal notranslate"><span class="pre">FetchContent</span></code>:</p>
<ol class="arabic">
<li><dl class="simple">
<dt><strong>Declarando</strong> o conteúdo a ser buscado com <a class="reference internal" href="https://cmake.org/cmake/help/latest/module/FetchContent.html"><span class="xref std std-term"><code class="docutils literal notranslate">FetchContent_Declare</code></span></a>.</dt><dd><p>Pode ser um tarball (local ou remoto), uma pasta local ou um
repositório de controle de versão (Git, SVN, etc.).</p>
</dd>
</dl>
<div class="admonition-fetchcontent-declare signature toggle-shown dropdown admonition" id="signature-0">
<p class="admonition-title"><a class="reference internal" href="https://cmake.org/cmake/help/latest/module/FetchContent.html"><span class="xref std std-term"><code class="docutils literal notranslate">FetchContent_Declare</code></span></a></p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">FetchContent_Declare</span><span class="p">(</span><span class="s">&lt;name&gt;</span><span class="w"> </span><span class="s">&lt;contentOptions&gt;...</span><span class="p">)</span>
</pre></div>
</div>
<p>O comando aceita como <code class="docutils literal notranslate"><span class="pre">&lt;contentOptions&gt;</span></code> as mesmas opções que daria
para <code class="docutils literal notranslate"><span class="pre">ExternalProject_Add</span></code> nas etapas <em>download</em> e
<em>update/patch</em>. veja mais em <a class="reference external" href="https://cmake.org/cmake/help/latest/module/ExternalProject.html#command:externalproject_add">https://cmake.org/cmake/help/latest/module/ExternalProject.html#command:externalproject_add</a>.</p>
<p>Para baixar o código de um repositório Git, você deve definir o seguinte:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">GIT_REPOSITORY</span></code>, a localização do repositório.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GIT_TAG</span></code>, a versão (tag, branch, commit hash) para o check out.</p></li>
</ul>
<p>Considerando que para baixar um tarball você só precisa definir:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">URL</span></code>, a localização online do tarball.</p></li>
</ul>
</div>
</li>
<li><dl class="simple">
<dt><strong>Populando</strong> o conteúdo com <a class="reference internal" href="https://cmake.org/cmake/help/latest/module/FetchContent.html"><span class="xref std std-term"><code class="docutils literal notranslate">FetchContent_MakeAvailable</code></span></a>.</dt><dd><p>Este comando <em>adiciona</em> os alvos declarados no conteúdo externo ao
seu sistema de compilação.</p>
</dd>
</dl>
<div class="admonition-fetchcontent-makeavailable signature toggle-shown dropdown admonition" id="signature-1">
<p class="admonition-title"><a class="reference internal" href="https://cmake.org/cmake/help/latest/module/FetchContent.html"><span class="xref std std-term"><code class="docutils literal notranslate">FetchContent_MakeAvailable</code></span></a></p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">FetchContent_MakeAvailable</span><span class="p">(</span><span class="w"> </span><span class="s">&lt;name1&gt;</span><span class="w"> </span><span class="s">[&lt;name2&gt;...]</span><span class="w"> </span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Como os alvos do projeto externo são adicionados ao seu próprio projeto,
você poderá usá-los da mesma maneira que faria ao obtê-los por meio de uma
chamada para <a class="reference internal" href="https://cmake.org/cmake/help/latest/command/find_package.html"><span class="xref std std-term"><code class="docutils literal notranslate">find_package</code></span></a>: você pode usar o conteúdo <em>found</em> e <em>fetched</em>
na mesma maneira. Se você precisa definir opções para criar o projeto externo,
você as definirá como variáveis CMake <em>antes</em> de chamar
<a class="reference internal" href="https://cmake.org/cmake/help/latest/module/FetchContent.html"><span class="xref std std-term"><code class="docutils literal notranslate">FetchContent_MakeAvailable</code></span></a>.</p>
</li>
</ol>
<section id="testes-unitarios-com-catch2">
<h3>Testes unitários com Catch2<a class="headerlink" href="#testes-unitarios-com-catch2" title="Permalink to this heading"></a></h3>
<p>O teste de unidade é uma técnica valiosa em engenharia de software:
ele pode ajudar a identificar regressões funcionais com um nível muito fino de
controle, pois cada teste de unidade destina-se a exercitar componentes
isolados em sua base de código. Equipar sua base de código com
integração <em>e</em> testes de unidade é uma prática muito boa.</p>
<p>Existem muitas estruturas de teste de unidade para a linguagem C++.
Cada um deles enfatiza uma abordagem ligeiramente diferente para
testes de unidade e vem com suas próprias peculiaridades na
configuração e uso.</p>
<p>Nesta atividade, mostraremos como usar <a class="reference external" href="https://github.com/catchorg/Catch2">Catch2</a> uma estrutura de teste de unidade
muito popular que enfatiza um fluxo de trabalho de desenvolvimento orientado
a testes. Catch2 é distribuído como um arquivo de cabeçalho único, que é uma
de suas características mais atraentes: pode ser facilmente incluído em
qualquer projeto. Em vez de baixar o arquivo de cabeçalho e adicioná-lo à
nossa base de código, podemos usar <code class="docutils literal notranslate"><span class="pre">FetchContent</span></code> para satisfazer essa
dependência para nós quando necessário.</p>
<div class="admonition-exercicio-26-catch2-recarregado exercise important admonition" id="exercise-0">
<p class="admonition-title">Exercício 26: Catch2 recarregado</p>
<p>Queremos usar a estrutura de teste de unidade Catch2 em nosso código.
Neste exercício, faremos o download do projeto Catch2 no momento da
configuração de seu <a class="reference external" href="https://github.com/catchorg/Catch2">repositório GitHub</a>.</p>
<p>O projeto base está em <code class="docutils literal notranslate"><span class="pre">source/code/day-2/26_more-catch2</span></code>.</p>
<ol class="arabic simple">
<li><p>Crie um projeto C++.</p></li>
<li><p>Defina o padrão C++ para C++14. Catch2 também funcionará com C++11.</p></li>
<li><p>Crie uma biblioteca a partir do arquivo fonte <code class="docutils literal notranslate"><span class="pre">sum_integers.cpp</span></code>.</p></li>
<li><p>Vincule a biblioteca em um executável <code class="docutils literal notranslate"><span class="pre">sum_up</span></code>.</p></li>
<li><p>Inclua o módulo <code class="docutils literal notranslate"><span class="pre">FetchContent</span></code> e declare o conteúdo <code class="docutils literal notranslate"><span class="pre">Catch2</span></code>.
Queremos baixar a tag <code class="docutils literal notranslate"><span class="pre">v2.13.4</span></code> do <a class="reference external" href="https://github.com/catchorg/Catch2">repositório oficial do Git</a>.</p></li>
<li><p>Faça o conteúdo <code class="docutils literal notranslate"><span class="pre">Catch2</span></code> disponível.</p></li>
<li><p>Crie o executável <code class="docutils literal notranslate"><span class="pre">cpp_test</span></code>.</p></li>
<li><p>Habilite o teste e adicione um teste.
Você terá que verificar como chamar um executável Catch2 na <a class="reference external" href="https://github.com/catchorg/Catch2/blob/v2.x/docs/command-line.md#specifying-which-tests-to-executar">documentação</a>.</p></li>
<li><p>Tente rodar seus testes.</p></li>
</ol>
<ul>
<li><p>Que diferenças você observa na etapa de configuração?</p></li>
<li><p>O que acontece se você esquecer de emitir o comando <a class="reference internal" href="https://cmake.org/cmake/help/latest/module/FetchContent.html"><span class="xref std std-term"><code class="docutils literal notranslate">FetchContent_MakeAvailable</code></span></a>?</p></li>
<li><p>Quais alvos são construídos no projeto? Quais são do Catch2?  Você pode usar o seguinte comando para obter uma lista de todos os destinos disponíveis:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cmake<span class="w"> </span>--build<span class="w"> </span>build<span class="w"> </span>--target<span class="w"> </span><span class="nb">help</span>
</pre></div>
</div>
</li>
</ul>
<p>Uma solução funcional está na subpasta <code class="docutils literal notranslate"><span class="pre">solution</span></code>.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Atençao</p>
<p><code class="docutils literal notranslate"><span class="pre">FetchContent</span></code> é um módulo poderoso em sua caixa de ferramentas CMake.
<strong>Cuidado!</strong> Satisfazer <em>todas</em> as dependências do seu código dessa forma
fará com que a duração dos estágios de configuração e construção aumentem.</p>
</div>
<div class="admonition-resumo keypoints admonition" id="keypoints-0">
<p class="admonition-title">Resumo</p>
<ul class="simple">
<li><p>CMake permite que você satisfaça dependências <em>on-the-fly</em>.</p></li>
<li><p>Você pode fazer isso em tempo de compilação com <code class="docutils literal notranslate"><span class="pre">ExternalProject</span></code>, mas você precisa adotar um framework superbuild.</p></li>
<li><p>No momento da configuração, você pode usar o módulo <code class="docutils literal notranslate"><span class="pre">FetchContent</span></code>: ele só pode ser aplicado com dependências que também usam CMake.</p></li>
</ul>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="dependencies.html" class="btn btn-neutral float-left" title="A07 - Encontrando e usando dependências" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="python-bindings.html" class="btn btn-neutral float-right" title="A09 - Misturando Python e linguagens compiladas" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Jose J. Camata.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>